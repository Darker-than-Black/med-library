<p-toolbar *ngIf="toolbarTemplate || localSettings.export">
  <div class="flex align-items-center justify-content-start">
    <button
      *ngIf="localSettings.export"
      pButton
      pRipple
      type="button"
      icon="pi pi-file-excel"
      class="p-button-rounded p-button-success mr-4"
      (click)="exportData()"
    ></button>

    <ng-container *ngTemplateOutlet="toolbarTemplate || null"></ng-container>
  </div>
</p-toolbar>

<div #upScrollRef class="med-table__up-scroll">
  <div #upScrollItemRef class="med-table__up-scroll-item"></div>
</div>

<p-table
  #tableRef
  class="med-table"
  [value]="data"
  [columns]="config"
  [loading]="loading"
  [rows]="localSettings.rows"
  [globalFilterFields]="filterableFields"
  [paginator]="localSettings.paginator"
  [filterDelay]="localSettings.filterDelay"
  [scrollHeight]="localSettings.scrollHeight"
  [rowsPerPageOptions]="localSettings.rowsPerPageOptions"
  [showCurrentPageReport]="localSettings.showCurrentPageReport"
  [currentPageReportTemplate]="localSettings.currentPageReportTemplate"
  (onFilter)="onFilter($event)"
>
  <ng-template pTemplate="caption">
    <span class="p-input-icon-left p-ml-auto">
      <i class="pi pi-search"></i>
      <input
        pInputText
        type="text"
        placeholder="Search keyword"
        (input)="tableRef.filterGlobal($any($event.target).value, 'contains')"
      />
    </span>
  </ng-template>

  <ng-template pTemplate="header">
    <tr>
      <th
        *ngFor="let col of config"
        [pSortableColumn]="col.sortKey || col.key"
        [style.minWidth]="col.minWidth || localSettings.colMinWidth"
        [style.maxWidth]="col.maxWidth || localSettings.colMaxWidth"
        class="med-table__th"
      >
        <span>{{ col.label }}</span>
        <p-sortIcon *ngIf="col.label" [field]="col.key"></p-sortIcon>
      </th>
    </tr>

    <tr *ngIf="filterableFields.length">
      <th *ngFor="let col of config" class="med-table__th">
        <ng-container *ngIf="col.filterable" [ngSwitch]="col.filterType">
          <filter-select
            *ngSwitchCase="FILTER_TYPES.SELECT"
            [key]="col.sortKey || col.key"
            [filterDataHandler]="filterDataHandler"
          ></filter-select>

          <filter-date
            *ngSwitchCase="FILTER_TYPES.DATE"
            [key]="col.sortKey || col.key"
          ></filter-date>

          <filter-text *ngSwitchDefault [key]="col.sortKey || col.key"></filter-text>
        </ng-container>
      </th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-item>
    <tr class="med-table__row">
      <td *ngFor="let column of config" class="med-table__td">
        <table-cell
          [item]="item"
          [config]="column"
          [template]="tdTemplate"
          (update)="updateColumn.emit($event)"
        ></table-cell>

        <ng-template #tdTemplate let-data let-item="item">
          <ng-container *ngTemplateOutlet="
            tableDataTemplate || null
            context: { $implicit: data, item: item, config: column }"
          ></ng-container>
        </ng-template>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td [attr.colspan]="config.length">{{ localSettings.emptyMessage }}</td>
    </tr>
  </ng-template>

  <ng-template *ngIf="paginatorTemplate" pTemplate="paginatorleft">
    <ng-container *ngTemplateOutlet="paginatorTemplate || null"></ng-container>
  </ng-template>
</p-table>
